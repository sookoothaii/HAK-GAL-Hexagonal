{
  "id": "multi-agent-research",
  "name": "Multi-Agent Forschungs-Pipeline",
  "description": "Parallele Recherche mit mehreren KI-Agenten und Konsens-Bildung",
  "nodes": [
    {
      "id": "input_1",
      "type": "input",
      "position": { "x": 100, "y": 100 },
      "data": {
        "name": "research_topic",
        "description": "Forschungsthema eingeben"
      }
    },
    {
      "id": "set_var_1",
      "type": "set_variable",
      "position": { "x": 100, "y": 200 },
      "data": {
        "name": "topic",
        "value": "{{input_1.research_topic}}"
      }
    },
    {
      "id": "parallel_1",
      "type": "parallel",
      "position": { "x": 100, "y": 300 },
      "data": {
        "max_concurrent": 4
      }
    },
    {
      "id": "search_kb_1",
      "type": "search_knowledge",
      "position": { "x": 300, "y": 400 },
      "data": {
        "query": "{{topic}}",
        "limit": 20
      }
    },
    {
      "id": "delegate_gemini_1",
      "type": "delegate_task",
      "position": { "x": 500, "y": 400 },
      "data": {
        "target_agent": "gemini",
        "task_description": "Recherchiere umfassend zum Thema: {{topic}}. Erstelle eine strukturierte Zusammenfassung mit Quellen.",
        "context": {
          "research_type": "comprehensive",
          "topic": "{{topic}}"
        }
      }
    },
    {
      "id": "delegate_deepseek_1",
      "type": "delegate_task",
      "position": { "x": 700, "y": 400 },
      "data": {
        "target_agent": "deepseek",
        "task_description": "Analysiere die technischen Aspekte von {{topic}}. Fokus auf Implementation Details und Best Practices.",
        "context": {
          "research_type": "technical",
          "topic": "{{topic}}"
        }
      }
    },
    {
      "id": "execute_code_1",
      "type": "execute_code",
      "position": { "x": 900, "y": 400 },
      "data": {
        "language": "python",
        "code": "import requests\nimport json\n\ntopic = '{{topic}}'\n# Simuliere Web-Scraping\nresults = {\n    'topic': topic,\n    'sources': ['arxiv.org', 'github.com', 'stackoverflow.com'],\n    'summary': f'Technische Ressourcen zu {topic}'\n}\nprint(json.dumps(results, indent=2))",
        "timeout": 10
      }
    },
    {
      "id": "wait_all_1",
      "type": "wait_for_all",
      "position": { "x": 100, "y": 600 },
      "data": {
        "timeout": 60000,
        "description": "Warte auf alle Recherche-Ergebnisse"
      }
    },
    {
      "id": "merge_2",
      "type": "merge",
      "position": { "x": 100, "y": 700 },
      "data": {
        "strategy": "all"
      }
    },
    {
      "id": "consensus_1",
      "type": "consensus_evaluator",
      "position": { "x": 100, "y": 800 },
      "data": {
        "task_id": "research_{{topic}}_{{workflow.id}}",
        "outputs": [
          {
            "tool_name": "search_knowledge",
            "content": "{{search_kb_1.results}}",
            "confidence": 0.8
          },
          {
            "tool_name": "gemini",
            "content": "{{delegate_gemini_1.response}}",
            "model": "gemini-1.5-flash",
            "confidence": 0.9
          },
          {
            "tool_name": "deepseek",
            "content": "{{delegate_deepseek_1.response}}",
            "model": "deepseek-v3",
            "confidence": 0.85
          },
          {
            "tool_name": "web_scraper",
            "content": "{{execute_code_1.output}}",
            "confidence": 0.7
          }
        ],
        "method": "semantic_similarity",
        "threshold": 0.7
      }
    },
    {
      "id": "branch_consensus",
      "type": "branch",
      "position": { "x": 100, "y": 900 },
      "data": {
        "condition": "{{consensus_1.consensus_score}} > 0.7"
      }
    },
    {
      "id": "string_template_1",
      "type": "string_template",
      "position": { "x": 250, "y": 1000 },
      "data": {
        "template": "# Research Report: {{topic}}\n\n## Konsens-Score: {{consensus_1.consensus_score}}\n\n## Zusammenfassung:\n{{consensus_1.summary}}\n\n## Details:\n- KB Fakten: {{search_kb_1.count}} gefunden\n- Gemini: {{delegate_gemini_1.status}}\n- DeepSeek: {{delegate_deepseek_1.status}}\n- Web Sources: {{execute_code_1.status}}"
      }
    },
    {
      "id": "create_file_1",
      "type": "create_file",
      "position": { "x": 250, "y": 1100 },
      "data": {
        "path": "reports/research_{{topic}}_{{workflow.timestamp}}.md",
        "content": "{{string_template_1.output}}",
        "auth_token": "{{env.WRITE_TOKEN}}"
      }
    },
    {
      "id": "add_fact_2",
      "type": "add_fact",
      "position": { "x": 250, "y": 1200 },
      "data": {
        "statement": "ResearchComplete({{topic}}, {{workflow.timestamp}}, consensus_{{consensus_1.consensus_score}}).",
        "auth_token": "{{env.WRITE_TOKEN}}"
      }
    },
    {
      "id": "project_snapshot_1",
      "type": "project_snapshot",
      "position": { "x": 250, "y": 1300 },
      "data": {
        "title": "Research_{{topic}}_{{workflow.date}}",
        "description": "Multi-Agent Research zu {{topic}} mit Konsens {{consensus_1.consensus_score}}",
        "auth_token": "{{env.WRITE_TOKEN}}"
      }
    },
    {
      "id": "delegation_opt_1",
      "type": "delegation_optimizer",
      "position": { "x": 50, "y": 1000 },
      "data": {
        "task_description": "Verbesserte Recherche zu {{topic}} - vorherige Ergebnisse waren nicht eindeutig genug",
        "available_tools": ["gemini", "claude_cli", "deepseek", "cursor"],
        "context": {
          "previous_consensus": "{{consensus_1.consensus_score}}",
          "topic": "{{topic}}"
        }
      }
    },
    {
      "id": "retry_1",
      "type": "retry_with_backoff",
      "position": { "x": 50, "y": 1100 },
      "data": {
        "target_node": "parallel_1",
        "max_retries": 2,
        "backoff_factor": 2
      }
    }
  ],
  "edges": [
    { "id": "e1", "source": "input_1", "target": "set_var_1" },
    { "id": "e2", "source": "set_var_1", "target": "parallel_1" },
    { "id": "e3", "source": "parallel_1", "target": "search_kb_1" },
    { "id": "e4", "source": "parallel_1", "target": "delegate_gemini_1" },
    { "id": "e5", "source": "parallel_1", "target": "delegate_deepseek_1" },
    { "id": "e6", "source": "parallel_1", "target": "execute_code_1" },
    { "id": "e7", "source": "search_kb_1", "target": "wait_all_1" },
    { "id": "e8", "source": "delegate_gemini_1", "target": "wait_all_1" },
    { "id": "e9", "source": "delegate_deepseek_1", "target": "wait_all_1" },
    { "id": "e10", "source": "execute_code_1", "target": "wait_all_1" },
    { "id": "e11", "source": "wait_all_1", "target": "merge_2" },
    { "id": "e12", "source": "merge_2", "target": "consensus_1" },
    { "id": "e13", "source": "consensus_1", "target": "branch_consensus" },
    { "id": "e14", "source": "branch_consensus", "sourceHandle": "true", "target": "string_template_1" },
    { "id": "e15", "source": "string_template_1", "target": "create_file_1" },
    { "id": "e16", "source": "create_file_1", "target": "add_fact_2" },
    { "id": "e17", "source": "add_fact_2", "target": "project_snapshot_1" },
    { "id": "e18", "source": "branch_consensus", "sourceHandle": "false", "target": "delegation_opt_1" },
    { "id": "e19", "source": "delegation_opt_1", "target": "retry_1" }
  ],
  "version": "1.0"
}