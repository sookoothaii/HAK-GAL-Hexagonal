# üöÄ Auto-Add Facts Feature
**Automatically add LLM-generated facts to your Knowledge Base**

---

## ‚úÖ Installation Complete!

The Auto-Add feature has been successfully integrated into HAK-GAL. This feature allows you to automatically validate and add facts generated by the LLM (Ollama/Phi3) to your Knowledge Base.

---

## üìã What Was Added

1. **`auto_add_facts.py`** - Standalone script for batch processing
2. **`auto_add_extension.py`** - API extension with new endpoints
3. **`test_auto_add.py`** - Test suite for the feature
4. **`frontend_auto_add.js`** - Frontend integration helper

### New API Endpoints

#### `/api/llm/auto-add` (POST)
Validates and adds multiple facts to the Knowledge Base.

**Request:**
```json
{
    "suggested_facts": [
        {"statement": "IsA(Plato, Philosopher).", "confidence": 0.8},
        {"statement": "TeacherOf(Socrates, Plato).", "confidence": 0.9}
    ],
    "confidence_threshold": 0.7,
    "validate": true,
    "check_duplicates": true
}
```

**Response:**
```json
{
    "added_count": 2,
    "rejected_count": 0,
    "duplicate_count": 0,
    "results": {
        "added": ["IsA(Plato, Philosopher).", "TeacherOf(Socrates, Plato)."],
        "rejected": [],
        "duplicates": []
    }
}
```

#### `/api/llm/suggest-and-add` (POST)
Gets LLM suggestions and optionally auto-adds them in one step.

**Request:**
```json
{
    "topic": "Ancient Philosophy",
    "context_facts": ["IsA(Socrates, Philosopher)."],
    "auto_add": true,
    "confidence_threshold": 0.7
}
```

---

## üéØ How to Use

### Method 1: Command Line (Batch Processing)

```powershell
# Test with example data
python auto_add_facts.py test

# Process a specific query
python auto_add_facts.py "Computer Architecture"

# Interactive mode
python auto_add_facts.py
```

### Method 2: Test Scripts

```powershell
# Test auto-add functionality
python test_auto_add.py

# Test combined endpoint
python test_auto_add.py combined
```

### Method 3: Direct API Calls

```powershell
# PowerShell example
$facts = @(
    @{statement = "HasPart(Computer, GPU)."; confidence = 0.8},
    @{statement = "HasPart(Computer, PSU)."; confidence = 0.7}
)

Invoke-RestMethod -Uri "http://localhost:5002/api/llm/auto-add" `
    -Method POST `
    -Body (@{
        suggested_facts = $facts
        confidence_threshold = 0.6
        validate = $true
        check_duplicates = $true
    } | ConvertTo-Json) `
    -ContentType "application/json"
```

### Method 4: Frontend Integration

Add the `frontend_auto_add.js` to your HTML:

```html
<script src="frontend_auto_add.js"></script>
<script>
    // Initialize
    const factAdder = new FactAutoAdder();
    
    // Auto-add facts from LLM response
    async function handleSuggestedFacts(facts) {
        const results = await factAdder.autoAddFacts(facts);
        factAdder.displayResults(results);
    }
</script>
```

---

## ‚öôÔ∏è Configuration Options

### Confidence Threshold
- **Default:** 0.7 (70%)
- **Range:** 0.0 to 1.0
- Facts below threshold are rejected

### Validation Rules
- **Format:** Must match `Predicate(Entity1, Entity2).`
- **Length:** Predicate ‚â• 3 chars, Entities 2-50 chars
- **Excludes:** Test terms (Test, Example, Foo, Bar, etc.)

### Duplicate Checking
- **Enabled by default**
- Checks for exact matches in KB
- Prevents redundant facts

---

## üìä Validation Process

1. **Format Check** ‚úì
   - Valid: `IsA(Socrates, Philosopher).`
   - Invalid: `Socrates is a philosopher`

2. **Quality Check** ‚úì
   - No test/example terms
   - Reasonable entity lengths
   - Valid predicates

3. **Confidence Check** ‚úì
   - Facts must meet minimum confidence
   - Default: 70%

4. **Duplicate Check** ‚úì
   - Prevents adding existing facts
   - Exact match comparison

5. **Add to KB** ‚úì
   - Includes metadata (source, timestamp, confidence)
   - Returns success/failure status

---

## üîç Monitoring

### Check Results
After auto-adding facts, you can verify:

```powershell
# Check fact count
curl http://localhost:5002/api/facts/count

# Search for added facts
Invoke-RestMethod -Uri "http://localhost:5002/api/search" `
    -Method POST `
    -Body (@{query = "Philosopher"; limit = 10} | ConvertTo-Json) `
    -ContentType "application/json"
```

### View Logs
The API will log auto-add operations:
```
[LLM] Extracted 10 facts
[Auto-Add] Processing 10 facts
[Auto-Add] Added: 7, Rejected: 1, Duplicates: 2
```

---

## üö® Troubleshooting

| Issue | Solution |
|-------|----------|
| No facts added | Check confidence threshold, lower if needed |
| All rejected | Verify fact format matches requirements |
| API endpoint not found | Restart API after update |
| Timeout errors | Increase timeout in requests |

---

## üìà Best Practices

1. **Review Before Adding**
   - Check suggested facts for quality
   - Adjust confidence threshold as needed

2. **Batch Processing**
   - Process multiple queries together
   - Use the standalone script for large batches

3. **Monitor Quality**
   - Track rejection rates
   - Adjust validation rules if needed

4. **Regular Cleanup**
   - Remove low-quality facts periodically
   - Check for contradictions

---

## üéØ Quick Start Example

```powershell
# 1. Start API (if not running)
python src_hexagonal/hexagonal_api_enhanced_clean.py

# 2. Run a query and auto-add facts
python -c "
import requests
response = requests.post(
    'http://localhost:5002/api/llm/suggest-and-add',
    json={
        'topic': 'Machine Learning',
        'auto_add': True,
        'confidence_threshold': 0.6
    }
)
result = response.json()
print(f\"Added {result.get('facts_added', 0)} facts\")
"
```

---

## ‚úÖ Status

**Feature Status:** FULLY OPERATIONAL ‚úÖ

- API Integration: ‚úÖ Complete
- Validation Logic: ‚úÖ Working
- Duplicate Detection: ‚úÖ Active
- Frontend Helper: ‚úÖ Ready
- Documentation: ‚úÖ Complete

---

## üìù Notes

- Facts are added with metadata tracking source and confidence
- The system maintains an audit trail of all additions
- Rejected facts are logged but not stored
- You can always manually review and remove facts

---

**Auto-Add Feature is ready to use! Start adding facts automatically from your LLM responses.** üöÄ
